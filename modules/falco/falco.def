Bootstrap: docker
From: almalinux:9

%setup

%files
    ../../external/htslib.20250110.tar.gz /opt
    ../../external/falco.20250110.tar.gz /opt

%post
    dnf -y install python3-devel pip \
                   gcc-c++ make-4.3 zlib-devel-1.2.11 cmake \
                   xz-devel autoconf automake bzip2-devel

    pushd /opt
        # install htslib
        # cf) https://kazumaxneo.hatenablog.com/entry/2024/05/10/024009
        if true ; then
            tar xvfz htslib.20250110.tar.gz
            pushd htslib
                autoheader
                autoreconf -i
                ./configure
                make -j$(nproc)
                make install
            popd
        fi
    
        # install falco
        # cf) https://kazumaxneo.hatenablog.com/entry/2024/04/20/011400
        if true ; then
            tar xvfz falco.20250110.tar.gz
            pushd falco
                ./autogen.sh
                ./configure CXXFLAGS="-O3 -Wall" --enable-hts
                make -j$(nproc) HAVE_HTSLIB=1 all
                make HAVE_HTSLIB=1 install
            popd
        fi
    popd

%environment
    export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH

%runscript
    falco -h
