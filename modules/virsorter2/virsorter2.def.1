Bootstrap: localimage
From: ../common/el9.sif

%setup

%files
    ../../external/db.tar.gz /opt

%post
    pushd /opt
        /opt/miniconda3/bin/mamba install -y \
            python=3.9.21 virsorter=2.2.4 \
            libarchive=3.7.7
        # install database
        tar -I pigz -xvf /opt/db.tar.gz -C . --no-same-owner 
        chown -R $(whoami) db
        chmod -R 777 db
        /opt/miniconda3/bin/virsorter config --init-source --db-dir=./db
    popd

%environment
    export LC_ALL=C
    export PATH=/opt/miniconda3/bin:$PATH

%runscript
    virsorter -h
    
